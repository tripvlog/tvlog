<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC '-//ibatis.apache.org//DTD Sql Map 2.0//EN' 'http://ibatis.apache.org/dtd/sql-map-2.dtd'>
<sqlMap namespace="post">

<typeAlias alias="dto" type="trip.post.boardVO"/>

<select id="All" resultClass="dto">         
         SELECT * FROM t_post where p_public='1' ORDER BY no DESC
</select>

<select id="public_4" resultClass="dto" parameterClass="String">
 select * from t_post where id=#id# or p_public='1' ORDER BY no DESC
</select>

<select id="public_2" resultClass="dto" parameterClass="String">
 select friend_id from t_friend where id=#id# 
</select>

<select id="sessionList" parameterClass="string" resultClass="dto">
<![CDATA[select * from(select a.* from (select * from t_post where p_public < 4) a, (select * from t_friend where id='test') b 
where a.id = b.friend_id
union
select * from t_post where p_public < 2) order by regdate desc]]>
</select>

<select id="sessionFriend" parameterClass="String" resultClass="dto">
	<![CDATA[select * from t_post where id=#friend_id# and p_public <3 order by no desc]]>
</select>

<select id="friendPost" parameterClass="dto" resultClass="dto">
	select * from t_post where id=#friend_id# and p_public='4' order by no desc
</select>

<select id="friendOnly" parameterClass="String" resultClass="dto">
<![CDATA[ select * from(select a.* from (select * from t_post where p_public < 4) a, (select * from t_friend where id=#id#) b 
where a.id = b.friend_id) order by no desc]]>
</select>

<select id="mypost" parameterClass="String" resultClass="dto">
select * from t_post where id=#id#
</select>

<insert id="insertPost" parameterClass="dto">
      
            INSERT INTO t_post (NO,
            					id,
                         	  SUBJECT,
                           	 CONTENT,
                           	 select_p,
                           	 p_public,
                               REGDATE
                         )
                    VALUES (t_post_seq.NEXTVAL,
                          	#id#,
                          	#subject#,
             			    #content#,
             			    #select_p#,
             			    #p_public#,
                            #regdate#
                         )
</insert>



 <update id="updateReadHit" parameterClass="dto">
       UPDATE t_post SET READHIT = readHit + 1 WHERE no = #no#
</update>

<select id="search" resultClass="dto" >         
         SELECT * FROM t_post  where no=#no#
</select>

<select id="uploadAll" parameterClass="int" resultClass="dto">   
   SELECT * FROM uploadboard where no=#no#
</select>


<delete id="deletePro" parameterClass="dto">
    delete from t_post where no=#no#
</delete>

<update id="update" parameterClass="dto">
   UPDATE t_post SET SUBJECT = #subject#,
   					select_p = #select_p#,
                      CONTENT = #content#                        
                     WHERE no = #no#
</update>
         
<insert id="insertComment" parameterClass="dto">
	insert into t_postcomment(no, co_no, id, content, regdate) 
					values(#no#, comment_no_seq.nextval, #id#, #content#, #regdate#)
</insert>   

<select id="selectComment" parameterClass="int" resultClass="dto">
    select * from  t_postcomment where no=#no# order by regdate asc
</select>

<delete id="deleteComment" parameterClass="dto">
   delete from t_postcomment where no=#no# and co_no=#co_no#
</delete>

 <select id="checkGood" parameterClass="dto" resultClass="int">
    select count(*) from t_postgood where id=#id# and no=#no#
 </select>

<insert id="insertPgood" parameterClass="dto">
       INSERT INTO t_postgood (NO,
                          id,
                          good
                         )
                    VALUES (#no#,
                            #id#,
                            'good'
                          )
 
 </insert>
 
 <update id="updateGood" parameterClass="int">
       UPDATE t_post SET good = good + 1 WHERE no = #no#
</update>

<delete id="deletePgood" parameterClass="dto">
   delete from t_postgood where no=#no# and id=#id#
</delete>

<update id="minusGood" parameterClass="int">
       UPDATE t_post SET good = good - 1 WHERE no = #no#
</update>

<select id="selectGood" parameterClass="int" resultClass="int">
               select good from t_post where no=#no#
</select>

<select id="modifysearch" resultClass="dto" parameterClass="dto">         
   select * from t_post where no=#no#
</select>



</sqlMap>