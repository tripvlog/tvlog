<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC '-//ibatis.apache.org//DTD Sql Map 2.0//EN' 'http://ibatis.apache.org/dtd/sql-map-2.dtd'>
<sqlMap>

	<select id="band_selectLastId" resultClass="int">
		select max(band_id) from t_band
	</select>
	
	<select id="band_select" resultClass="trip.band.BandDTO">
		<![CDATA[select * from t_band where band_range < 3]]>
	</select>
	
	<select id="band_view" resultClass="trip.band.BandDTO" parameterClass="trip.band.BandDTO">
		select * from t_band where band_id = #band_id#
	</select>
	
	<select id="band_content" resultClass="trip.band.boardDTO" parameterClass="int">
		select * from (select * from t_band_board_$band_id$ a, t_member b where b.id = a.band_board_writer) order by band_board_reg desc
	</select>
	
	<select id="main_band" resultClass="trip.band.BandDTO">
		<![CDATA[select * from (select * from t_band where band_range = 1 order by band_reg desc) where rownum <= 6]]>
	</select>
	
	<select id="band_member_info" resultClass="trip.band.memberDTO" parameterClass="int">
		select name, path from t_member where id = (select band_board_writer from t_band_board_$band_id$)
	</select>

	<select id="band_board_num" resultClass="int" parameterClass="int">
		select max(band_board_num) from t_band_board_$band_id$
	</select>
	
	<select id="band_img_select" resultClass="String" parameterClass="trip.band.imgDTO">
		select board_img from t_band_board_imgs_$band_id$ where board_num = #board_num#
	</select>
	
	<select id="band_board_select" resultClass="trip.band.boardDTO" parameterClass="trip.band.boardDTO">
		select * from t_band_board_$band_id$ where band_board_num = #band_board_num#
	</select>
	
	<select id="band_my_list" resultClass="trip.member.BandListDTO" parameterClass="trip.member.BandListDTO">
		select * from t_member_band_$member_id$
	</select>
	
<!-- =============================================================================== -->
	
	<update id="band_imgUpload" parameterClass="trip.band.BandDTO">
		update t_band set band_img = #band_img# where band_id = #band_id#
	</update>

	<update id="band_board_img" parameterClass="trip.band.boardDTO">
		update t_band_board_$band_id$ set band_board_img = #band_board_img# where band_board_num = #band_board_num#
	</update>
	
	<update id="band_modify_content" parameterClass="trip.band.boardDTO">
		update t_band_board_$band_id$ set band_board_content = #band_board_content# where band_board_num = #band_board_num#
	</update>

<!-- =============================================================================== -->

	<delete id="band_board_imgs_del" parameterClass="trip.band.imgDTO">
		delete t_band_board_imgs_$band_id$ where board_num = #board_num#
	</delete>
	
	<delete id="band_board_del" parameterClass="trip.band.imgDTO">
		delete t_band_board_$band_id$ where band_board_num = #board_num#
	</delete>

<!-- =============================================================================== -->
	<insert id="band_create" parameterClass="trip.band.BandDTO">
		insert into t_band(band_id, band_name, band_leader, band_intro, band_range, band_reg) values(t_band_seq.NEXTVAL, #band_name#, #band_leader#, #band_intro#, #band_range#, sysdate)
	</insert>
	
	<insert id="band_create_table_board" parameterClass="int">
		create table t_band_board_$band_id$(band_board_num number default 0 primary key, band_board_notice number default 0, band_board_writer varchar2(100), band_board_content varchar2(2000), band_board_img varchar2(3000), band_board_readcount number default 0, band_board_reg date default sysdate)
	</insert>
	
	<insert id="band_create_sequence_board" parameterClass="int">
		create sequence t_band_board_$band_id$_seq nocache
	</insert>
	
	<insert id="band_create_table_comment" parameterClass="int">
		create table t_band_board_comment_$band_id$(band_board_comment_bno number, band_board_comment_cno number, band_board_comment_writer varchar2(100), band_board_comment_comment varchar2(500), band_board_comment_reg date default sysdate)
	</insert>
	
	<insert id="band_create_table_member" parameterClass="int">
		create table t_band_member_$band_id$(band_member_no number, band_member_id varchar2(100), band_member_name varchar2(300), band_member_img varchar2(300), band_member_level number, band_member_reg date default sysdate)
	</insert>
	
	<insert id="band_create_sequence_member" parameterClass="int">
		create sequence t_band_member_$band_id$_seq nocache
	</insert>
	
	<insert id="band_create_table_board_imgs" parameterClass="int">
		create table t_band_board_imgs_$band_id$(board_num number, board_writer varchar2(100), board_img varchar2(200), board_img_reg date default sysdate)
	</insert>
	
	<insert id="band_insert_leader" parameterClass="java.util.Map">
		insert into t_band_member_$band_id$ values(t_band_member_$band_id$_seq.nextval, #leader_id#, #leader_name#, #band_member_img#, 2, sysdate)
	</insert>
	
	<insert id="band_board_write" parameterClass="trip.band.boardDTO">
		insert into t_band_board_$band_id$(band_board_num, band_board_writer, band_board_content, band_board_reg) values(t_band_board_$band_id$_seq.nextval, #band_board_writer#, #band_board_content#, sysdate)
	</insert>
	
	<insert id="band_board_insert_img" parameterClass="trip.band.imgDTO">
		insert into t_band_board_imgs_$band_id$ values(#board_num#, #board_writer#, #board_img#, sysdate)
	</insert>
	
<!-- ************************************* -->
	
</sqlMap>